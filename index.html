<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Customer List</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap">
</head>

<body>

 <div class="container">
    <h1 class="mt-5 mb-4 text-center">Via Lugano Filters List</h1>

    <div class="form-outline">
        <input type="search" id="form1" class="form-control" placeholder="Type query" aria-label="Search" />
    </div>
    <br>

    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th id="aptName">Apt Name</th>
                    <th id="filterSize">Filter Size</th>
                    <th>Delete</th>
                    <th>Update</th>
                </tr>
            </thead>
            <tbody id="customerList">
            </tbody>
        </table>
    </div>

    <button id="addBtn" class="btn btn-primary">Add Item</button>

    <!-- Add Item Modal -->
    <div class="modal fade" id="addItemModal" tabindex="-1" role="dialog" aria-labelledby="addItemModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addItemModalLabel">Add Item</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="addItemForm">
                        <div class="form-group">
                            <label for="itemName">Apartment Number:</label>
                            <input type="text" class="form-control" id="itemName" required>
                        </div>
                        <div class="form-group">
                            <label for="filterSize">Filter Size:</label>
                            <input type="text" class="form-control" id="filterSize" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" id="saveItemBtn" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    
        <!-- Modal -->
        <div class="modal fade" id="addItemModal" tabindex="-1" role="dialog" aria-labelledby="addItemModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addItemModalLabel">Add Item</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="addItemForm">
                            <div class="form-group">
                                <label for="itemName">Apartement Number:</label>
                                <input type="text" class="form-control" id="itemName" required>
                            </div>
                            <div class="form-group">
                                <label for="filterSize">Filter Size:</label>
                                <input type="text" class="form-control" id="filterSize" required>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" id="saveItemBtn" class="btn btn-primary">Save changes</button>
                    </div>
                </div>
            </div>
        </div>



        <div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="updateModalLabel">Update Customer Information</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="updateCustomerForm">
                            <div class="mb-3">
                                <label for="aptNameInput" class="form-label">Apartment Name</label>
                                <input type="text" class="form-control" id="aptNameInput" required>
                            </div>
                            <div class="mb-3">
                                <label for="filterSizeInput" class="form-label">Filter Size</label>
                                <input type="text" class="form-control" id="filterSizeInput" required>
                            </div>
                            <input type="hidden" id="customerId" name="customerId">
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" id="updateCustomerButton"
                            onclick="updateCustomer(id)">Update</button>
                    </div>
                </div>
            </div>
        </div>



    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.js"
        integrity="sha256-a9jBBRygX1Bh5lt8GZjXDzyOB+bWve9EiO7tROUtj/E=" crossorigin="anonymous"></script>
    <script>
        function fetchCustomers(searchTerm) {
            fetch('http://localhost:3003/cstm')
                .then(response => response.json())
                .then(customers => {
                    const customerList = document.getElementById('customerList');
                    customerList.innerHTML = ''; // Clear previous customer list

                    customers.sort(function (a, b) {
                        var numA = parseInt(a.aptName.split("-")[0]);
                        var numB = parseInt(b.aptName.split("-")[0]);
                        return numA - numB;
                    });

                    customers
                        .filter(customer => !searchTerm || (customer.aptName && customer.aptName.indexOf(searchTerm) !== -1)) // Filter customers based on the search term
                        .forEach(customer => {


                            const row = customerList.insertRow();
                            const aptNameCell = row.insertCell(0);
                            const filterSizeCell = row.insertCell(1);
                            const deleteButtonCell = row.insertCell(2);
                            const updateButtonCell = row.insertCell(3);

                            aptNameCell.innerHTML = customer.aptName;
                            filterSizeCell.innerHTML = customer.filterSize;

                            const deleteButton = document.createElement('button');
                            deleteButton.className = 'btn btn-danger';
                            deleteButton.innerHTML = 'Delete';
                            deleteButton.onclick = function () {
                                deleteCustomer(customer._id);
                            };
                            deleteButtonCell.appendChild(deleteButton);

                            //<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#updateModal"> Update </button>

                            const updateButton = document.createElement('button');
                            updateButton.className = 'btn btn-primary';
                            updateButton.setAttribute('data-toggle', 'modal');
                            updateButton.setAttribute('data-target', '#updateModal');
                            updateButton.setAttribute('id', "update-btn")
                            updateButton.innerHTML = '_';
                            updateButton.onclick = function () {
                                const aptNameInput = document.getElementById('aptNameInput');
                                const filterSizeInput = document.getElementById('filterSizeInput');
                                aptNameInput.value = customer.aptName;
                                filterSizeInput.value = customer.filterSize;
                            };

                            updateButtonCell.appendChild(updateButton);

                            const updateCustomerButton = document.getElementById('updateCustomerButton');
                            updateCustomerButton.onclick = function () {
                                const aptNameInput = document.getElementById('aptNameInput');
                                const filterSizeInput = document.getElementById('filterSizeInput');
                                const updatedCustomer = {
                                    aptName: aptNameInput.value,
                                    filterSize: filterSizeInput.value,
                                };
                                updateCustomer(customer._id, updatedCustomer);
                            };



                            // updateButton.onclick = function () {
                            //     updateCustomer(customer._id);
                            // };
                            // updateButtonCell.appendChild(updateButton);
                        });
                });
        }



        function deleteCustomer(id) {
            fetch(`http://localhost:3003/cstm/${id}`, { method: 'DELETE' })
                .then(() => location.reload())
                .catch(error => console.error(error));
        }

        function updateCustomer(id) {

        }

        const searchInput = document.getElementById('form1');
        searchInput.addEventListener('input', function (event) {
            const query = event.target.value;
            fetchCustomers(query);
            console.log(query);
        });



        // $(document).on("click", "#update-btn", function () {
        //     // Get the values from the table row
        //     const aptName = $(this).closest("tr").find("#aptName").text().trim();
        //     const filterSize = $(this).closest("tr").find("#filterSize").text().trim();



        //     // Populate the form fields with the original data
        //     $("#aptNameInput").val(aptName.data);
        //     $("#filterSizeInput").val(filterSize);


        //     // Show the modal
        //     $("#updateModal").modal("show");
        // });



        $(document).ready(function () {
            $("#addBtn").click(function () {
                $("#addItemModal").modal("show");
            
            });

            $("#saveItemBtn").click(function () {
                var itemName = $("#itemName").val();
                var filterSizes = $("#filterSize").val();

                var data = {
                    aptName: itemName,
                    filterSize: filterSizes
                };

                $.ajax({
                    type: "POST",
                    url: "http://localhost:3003/cstm",
                    dataType: "json",
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(data),
                    success: function () {
                        console.log(data);
                        location.reload();
                    }
                });
            });


            
        });


       

        fetchCustomers();
    </script>

</body>

</html>